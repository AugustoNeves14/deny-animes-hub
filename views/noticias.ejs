<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Akatsuki Hub | Notícias</title>
<!-- Font Awesome para ícones -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<!-- Google Fonts para uma tipografia mais forte -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;600;700&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    /*
    ================================================================
    TEMA DUAL "AKATSUKI SUPREMO" - ELEVADO
    ================================================================
    */
    :root {
        /* MODO ESCURO (PADRÃO) */
        --color-primary: #E50914;
        --color-primary-glow: rgba(229, 9, 20, 0.5);
        --color-primary-light: rgba(229, 9, 20, 0.1);
        --color-background: #000000;
        --color-surface: #101014;
        --color-surface-translucent: rgba(16, 16, 20, 0.8);
        --color-border: #2a2a2e;
        --color-text-primary: #f1f1f1;
        --color-text-secondary: #a1a1aa;
        --color-text-on-primary: #ffffff;
        
        --background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Cg fill-rule="evenodd"%3E%3Cg fill="%23e50914" fill-opacity="0.04"%3E%3Cpath opacity=".5" d="M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h16v-4h1v4h9v-4h1v4h9v-4h1v4h9v-4h1v4h9v-4h1v4h9v-4h1v4h9v-4h1v4h9v-4h1v4h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm0-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm0-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm0-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm0-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9z"/%3E%3Cpath d="M6 5V0h1v5h5v1H6v5H5V6H0V5h5z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
        --shadow-sm: 0 2px 5px rgba(0,0,0,0.3);
        --shadow-md: 0 5px 15px rgba(0,0,0,0.5);
        --shadow-lg: 0 10px 30px rgba(0,0,0,0.7);

        /* MODO MODAL */
        --modal-surface: #0c0c10;
        --modal-border: #222226;
        --modal-text-primary: #f1f1f1;
        --modal-text-secondary: #a1a1aa;

        /* FONTES */
        --font-heading: 'Poppins', Poppins;
        --font-body: 'Poppins', Poppins;
        
        /* GRADIENTES AKATSUKI */
        --akatsuki-gradient-1: linear-gradient(135deg, rgba(229, 9, 20, 0.03) 0%, rgba(229, 9, 20, 0.01) 100%);
        --akatsuki-gradient-2: linear-gradient(45deg, rgba(229, 9, 20, 0.05) 0%, transparent 50%);
        --akatsuki-gradient-3: radial-gradient(circle at 20% 80%, rgba(229, 9, 20, 0.04) 0%, transparent 50%);
    }

    body.light-mode {
        /* MODO CLARO (ALTERNATIVA) */
        --color-primary: #D32F2F;
        --color-primary-glow: rgba(211, 47, 47, 0.3);
        --color-primary-light: rgba(211, 47, 47, 0.05);
        --color-background: #f0f2f5;
        --color-surface: #ffffff;
        --color-surface-translucent: rgba(255, 255, 255, 0.8);
        --color-border: #e0e0e0;
        --color-text-primary: #1c1e21;
        --color-text-secondary: #606770;
        --color-text-on-primary: #ffffff;
        
        --background-image: none;
        --shadow-sm: 0 2px 4px rgba(0,0,0,0.06);
        --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
        --shadow-lg: 0 8px 25px rgba(0,0,0,0.1);

        --modal-surface: #ffffff;
        --modal-border: #e9ecef;
        --modal-text-primary: #212529;
        --modal-text-secondary: #6c757d;
        
        /* GRADIENTES AKATSUKI - MODO CLARO */
        --akatsuki-gradient-1: linear-gradient(135deg, rgba(211, 47, 47, 0.02) 0%, rgba(211, 47, 47, 0.005) 100%);
        --akatsuki-gradient-2: linear-gradient(45deg, rgba(211, 47, 47, 0.03) 0%, transparent 50%);
        --akatsuki-gradient-3: radial-gradient(circle at 20% 80%, rgba(211, 47, 47, 0.02) 0%, transparent 50%);
    }

    *, *::before, *::after { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    
    body {
        font-family: var(--font-body);
        background-color: var(--color-background);
        background-image: var(--background-image);
        color: var(--color-text-primary);
        margin: 0;
        padding-top: 80px;
        transition: background-color 0.4s ease, color 0.4s ease;
        position: relative;
        min-height: 100vh;
    }
    
    /* Gradientes Akatsuki no modo escuro */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: var(--akatsuki-gradient-1), var(--akatsuki-gradient-2), var(--akatsuki-gradient-3);
        pointer-events: none;
        z-index: -1;
        opacity: 0;
        transition: opacity 0.5s ease;
    }
    
    body:not(.light-mode)::before {
        opacity: 1;
    }
    
    body.modal-open { overflow: hidden; }

    .container { max-width: 1400px; margin: 0 auto; padding: 0 25px; }

    /*
    ================================================================
    NAVBAR UNIFICADA - ELEVADA
    ================================================================
    */
    .main-header {
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 80px;
        background-color: var(--color-surface-translucent);
        backdrop-filter: blur(15px); 
        -webkit-backdrop-filter: blur(15px);
        border-bottom: 1px solid var(--color-border);
        z-index: 900;
        transition: all 0.4s ease;
        box-shadow: var(--shadow-md);
    }
    
    .main-header.scrolled {
        height: 70px;
        background-color: var(--color-surface);
        box-shadow: var(--shadow-lg);
    }
    
    .main-header .container { 
        display: flex; 
        align-items: center; 
        justify-content: space-between; 
        height: 100%; 
    }
    
    .header-logo {
        font-family: var(--font-heading);
        font-size: 2.8rem;
        font-weight: 700;
        color: var(--color-text-primary);
        text-decoration: none;
        transition: all 0.3s;
        letter-spacing: 1px;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .header-logo .fa-cloud { 
        color: var(--color-primary); 
        transition: all 0.3s ease; 
        font-size: 2.5rem;
    }
    
    .header-logo:hover .fa-cloud { 
        transform: scale(1.1) rotate(10deg); 
        filter: drop-shadow(0 0 8px var(--color-primary-glow));
    }
    
    .header-logo:hover {
        color: var(--color-primary);
    }
    
    .main-nav {
        display: flex;
        align-items: center;
        gap: 30px;
    }
    
    .nav-link {
        color: var(--color-text-secondary);
        text-decoration: none;
        font-weight: 600;
        font-size: 1.1rem;
        padding: 8px 16px;
        border-radius: 8px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .nav-link::before {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 2px;
        background: var(--color-primary);
        transition: width 0.3s ease;
    }
    
    .nav-link:hover {
        color: var(--color-text-primary);
    }
    
    .nav-link:hover::before {
        width: 100%;
    }
    
    .nav-link.active {
        color: var(--color-primary);
    }
    
    .nav-link.active::before {
        width: 100%;
    }
    
    #theme-toggle-btn {
        background: transparent; 
        color: var(--color-text-secondary); 
        border: none;
        width: 46px; 
        height: 46px; 
        border-radius: 50%; 
        cursor: pointer;
        font-size: 1.4rem; 
        display: flex; 
        align-items: center; 
        justify-content: center;
        transition: all 0.4s ease; 
        position: relative;
        border: 1px solid var(--color-border);
    }
    
    #theme-toggle-btn:hover { 
        color: var(--color-primary); 
        transform: rotate(20deg); 
        border-color: var(--color-primary);
        box-shadow: 0 0 15px var(--color-primary-glow);
    }
    
    #theme-toggle-btn .theme-icon { 
        position: absolute; 
        transition: transform 0.4s ease, opacity 0.4s ease; 
    }
    
    .theme-icon.fa-sun { transform: scale(0); opacity: 0; }
    body.light-mode .theme-icon.fa-sun { transform: scale(1); opacity: 1; }
    body.light-mode .theme-icon.fa-moon { transform: scale(0); opacity: 0; }

    /*
    ================================================================
    LAYOUT PRINCIPAL MODERNO
    ================================================================
    */
    .main-layout { 
        display: grid; 
        grid-template-columns: 1fr; 
        gap: 40px; 
        padding-top: 50px; 
        padding-bottom: 50px; 
    }
    
    @media (min-width: 1024px) { 
        .main-layout { 
            grid-template-columns: minmax(0, 3fr) minmax(0, 1.2fr); 
        } 
    }
    
    /*
    ================================================================
    SEÇÃO DE NOTÍCIAS - UPGRADE MODERNO
    ================================================================
    */
    .news-section {
        position: relative;
    }
    
    .section-header {
        margin-bottom: 40px;
        position: relative;
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        flex-wrap: wrap;
        gap: 20px;
    }
    
    .section-title-main {
        font-family: var(--font-heading);
        font-size: 3.5rem;
        font-weight: 700;
        margin: 0;
        color: var(--color-text-primary);
        text-transform: uppercase;
        position: relative;
        display: inline-block;
    }
    
    .section-title-main i {
        color: var(--color-primary);
        margin-right: 15px;
    }
    
    .section-title-main::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 0;
        width: 80px;
        height: 4px;
        background: var(--color-primary);
        border-radius: 2px;
    }
    
    .section-subtitle {
        font-size: 1.2rem;
        color: var(--color-text-secondary);
        max-width: 600px;
        margin-top: 15px;
    }
    
    .news-filters {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .filter-btn {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        color: var(--color-text-secondary);
        padding: 8px 20px;
        border-radius: 30px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .filter-btn:hover, .filter-btn.active {
        background: var(--color-primary);
        color: var(--color-text-on-primary);
        border-color: var(--color-primary);
        transform: translateY(-2px);
    }
    
    .news-grid { 
        display: grid; 
        gap: 30px; 
    }

    /* Mobile: Matriz 1x1 */
    @media (max-width: 767px) {
        .news-grid { grid-template-columns: 1fr; gap: 20px; }
        .section-title-main { font-size: 2.5rem; }
    }
    /* Tablet */
    @media (min-width: 768px) and (max-width: 1199px) {
        .news-grid { grid-template-columns: repeat(2, 1fr); gap: 25px; }
    }
    /* Desktop */
    @media (min-width: 1200px) {
        .news-grid { grid-template-columns: repeat(3, 1fr); }
    }

    .news-card {
        background: var(--color-surface);
        border-radius: 16px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        border: 1px solid var(--color-border);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        text-decoration: none;
        box-shadow: var(--shadow-md);
        position: relative;
    }
    
    .news-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.6), 0 0 20px var(--color-primary-glow);
        border-color: var(--color-primary);
    }
    
    body.light-mode .news-card:hover { box-shadow: var(--shadow-lg); }
    
    .news-card__image-container {
        position: relative;
        aspect-ratio: 16/9;
        overflow: hidden;
    }
    
    .news-card__image-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    
    .news-card:hover .news-card__image-container img {
        transform: scale(1.05);
    }
    
    .news-card__category-badge {
        position: absolute;
        top: 15px;
        left: 15px;
        background: var(--color-primary);
        color: var(--color-text-on-primary);
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        z-index: 2;
    }
    
    .news-card__overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 60%);
        opacity: 0;
        transition: opacity 0.4s ease;
        display: flex;
        align-items: flex-end;
        justify-content: flex-end;
        padding: 20px;
    }
    
    .news-card:hover .news-card__overlay { opacity: 1; }
    
    .news-card__action-icon {
        width: 50px;
        height: 50px;
        background: var(--color-primary);
        border-radius: 50%;
        color: white;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: scale(0);
        transition: transform 0.3s ease 0.1s;
    }
    
    .news-card:hover .news-card__action-icon { transform: scale(1); }
    
    .news-card__content {
        padding: 25px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }
    
    .news-card__title {
        font-family: var(--font-body);
        font-weight: 700;
        font-size: 1.3rem;
        margin: 0 0 10px 0;
        line-height: 1.4;
        color: var(--color-text-primary);
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .news-card__excerpt {
        color: var(--color-text-secondary);
        font-size: 0.95rem;
        line-height: 1.6;
        margin-bottom: 15px;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        flex-grow: 1;
    }
    
    .news-card__meta {
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: var(--color-text-secondary);
        font-size: 0.85rem;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid var(--color-border);
    }
    
    .news-card__date {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .news-card__stats {
        display: flex;
        gap: 15px;
    }
    
    .news-card__stat {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .news-card__stat i {
        color: var(--color-primary);
    }
    
    .news-card__featured {
        position: relative;
        grid-column: 1 / -1;
    }
    
    @media (min-width: 768px) {
        .news-card__featured {
            grid-column: span 2;
            display: grid;
            grid-template-columns: 1fr 1fr;
        }
        
        .news-card__featured .news-card__image-container {
            aspect-ratio: auto;
        }
    }
    
    .news-card__featured-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: var(--color-primary);
        color: var(--color-text-on-primary);
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        z-index: 2;
    }
    
    .news-load-more {
        display: flex;
        justify-content: center;
        margin-top: 50px;
    }
    
    .load-more-btn {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        color: var(--color-text-primary);
        padding: 12px 30px;
        border-radius: 30px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .load-more-btn:hover {
        background: var(--color-primary);
        color: var(--color-text-on-primary);
        border-color: var(--color-primary);
        transform: translateY(-3px);
    }
    
    .news-empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--color-text-secondary);
    }
    
    .news-empty-state i {
        font-size: 4rem;
        margin-bottom: 20px;
        color: var(--color-border);
    }
    
    .news-empty-state h3 {
        font-size: 1.5rem;
        margin-bottom: 10px;
        color: var(--color-text-secondary);
    }

    /* 
    ================================================================
    SIDEBAR - ELEGANTE E SEM CONTAINER
    ================================================================
    */
    .sidebar-widget {
        background: var(--color-surface); 
        padding: 30px; 
        border-radius: 16px;
        margin-bottom: 40px; 
        border: 1px solid var(--color-border);
        box-shadow: var(--shadow-md);
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
    }
    
    .sidebar-widget::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--akatsuki-gradient-1);
        opacity: 0;
        transition: opacity 0.4s ease;
        pointer-events: none;
    }
    
    .sidebar-widget:hover::before {
        opacity: 1;
    }
    
    .sidebar-widget:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    }
    
    .sidebar-widget h3 { 
        font-family: var(--font-heading); 
        text-transform: uppercase;
        margin: 0 0 25px 0; 
        font-size: 2rem; 
        display: flex; 
        align-items: center;
        gap: 12px; 
        color: var(--color-text-primary);
        position: relative;
        padding-bottom: 15px;
    }
    
    .sidebar-widget h3::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 50px;
        height: 3px;
        background: var(--color-primary);
        border-radius: 2px;
    }
    
    .sidebar-widget h3 .fa-fire-alt, .sidebar-widget h3 .fa-film { 
        color: var(--color-primary); 
    }
    
    .ranking-list { 
        list-style: none; 
        padding: 0; 
        margin: 0; 
        display: flex; 
        flex-direction: column; 
        gap: 15px; 
    }
    
    .ranking-item a {
        display: grid; 
        grid-template-columns: 30px 60px 1fr;
        align-items: center; 
        gap: 15px; 
        text-decoration: none;
        padding: 15px; 
        border-radius: 12px;
        transition: all 0.3s ease;
        border: 1px solid transparent;
        position: relative; 
        overflow: hidden;
    }
    
    .ranking-item a::before { /* Efeito de brilho no hover */
        content: ''; 
        position: absolute; 
        top: 0; 
        left: -100%; 
        width: 50%; 
        height: 100%;
        background: linear-gradient(to right, transparent 0%, var(--color-primary-glow) 50%, transparent 100%);
        transition: left 0.6s ease;
    }
    
    .ranking-item a:hover { 
        background-color: rgba(255,255,255,0.05); 
        transform: translateX(5px);
        border-color: var(--color-border);
    }
    
    body.light-mode .ranking-item a:hover { background-color: rgba(0,0,0,0.03); }
    .ranking-item a:hover::before { left: 150%; }

    .rank-number {
        font-family: var(--font-heading); 
        font-size: 1.8rem; 
        font-weight: 700;
        color: var(--color-text-secondary); 
        text-align: center;
        transition: color 0.3s ease;
    }
    
    .ranking-item:nth-child(-n+3) .rank-number { 
        color: var(--color-primary); 
    }
    
    .ranking-item:hover .rank-number {
        color: var(--color-primary);
    }

    .ranking-item img { 
        width: 60px; 
        height: 90px; 
        object-fit: cover; 
        border-radius: 8px;
        transition: transform 0.3s ease;
    }
    
    .ranking-item:hover img {
        transform: scale(1.05);
    }
    
    .rank-info .title { 
        display: -webkit-box; 
        -webkit-line-clamp: 2; 
        -webkit-box-orient: vertical; 
        overflow: hidden;
        color: var(--color-text-primary); 
        font-weight: 700; 
        font-size: 1rem; 
        margin-bottom: 5px;
        transition: color 0.3s ease;
    }
    
    .ranking-item:hover .title {
        color: var(--color-primary);
    }
    
    .rank-info .details { 
        font-size: 0.8rem; 
        color: var(--color-text-secondary); 
        display: flex; 
        gap: 15px; 
        align-items: center;
    }
    
    .rank-info .details .fa-star { color: #f5c518; }
    
    /*
    ================================================================
    FOOTER ELEVADO
    ================================================================
    */
    .main-footer {
        background: var(--color-surface);
        border-top: 1px solid var(--color-border);
        padding: 60px 0 30px;
        margin-top: 80px;
        position: relative;
        overflow: hidden;
    }
    
    .main-footer::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--akatsuki-gradient-2);
        opacity: 0.5;
        pointer-events: none;
    }
    
    .footer-content {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 40px;
        margin-bottom: 40px;
    }
    
    @media (max-width: 991px) {
        .footer-content {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @media (max-width: 575px) {
        .footer-content {
            grid-template-columns: 1fr;
        }
    }
    
    .footer-column h4 {
        font-family: var(--font-heading);
        font-size: 1.3rem;
        color: var(--color-text-primary);
        margin-bottom: 20px;
        position: relative;
        padding-bottom: 10px;
    }
    
    .footer-column h4::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 30px;
        height: 2px;
        background: var(--color-primary);
    }
    
    .footer-links {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .footer-links li {
        margin-bottom: 12px;
    }
    
    .footer-links a {
        color: var(--color-text-secondary);
        text-decoration: none;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .footer-links a:hover {
        color: var(--color-primary);
        transform: translateX(5px);
    }
    
    .footer-links a i {
        font-size: 0.9rem;
        width: 20px;
        text-align: center;
    }
    
    .footer-social {
        display: flex;
        gap: 15px;
        margin-top: 20px;
    }
    
    .social-link {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 50%;
        color: var(--color-text-secondary);
        text-decoration: none;
        transition: all 0.3s ease;
    }
    
    .social-link:hover {
        background: var(--color-primary);
        color: var(--color-text-on-primary);
        border-color: var(--color-primary);
        transform: translateY(-3px);
    }
    
    .footer-bottom {
        border-top: 1px solid var(--color-border);
        padding-top: 30px;
        text-align: center;
        color: var(--color-text-secondary);
        font-size: 0.9rem;
    }
    
    .footer-logo {
        font-family: var(--font-heading);
        font-size: 2rem;
        font-weight: 700;
        color: var(--color-text-primary);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
    }
    
    .footer-logo .fa-cloud {
        color: var(--color-primary);
    }
    
    /*
    ================================================================
    MODAL SUPREMO (MELHORIAS)
    ================================================================
    */
    .modal {
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%;
        background-color: rgba(0, 0, 0, 0.85); 
        backdrop-filter: blur(8px);
        display: flex; 
        align-items: center; 
        justify-content: center;
        z-index: 1000; 
        opacity: 0; 
        visibility: hidden;
        transition: opacity 0.4s ease, visibility 0s 0.4s;
        padding: 20px;
    }
    
    .modal.active { 
        opacity: 1; 
        visibility: visible; 
        transition-delay: 0s; 
    }
    
    .modal__content {
        position: relative; 
        background: var(--modal-surface);
        width: 100%; 
        max-width: 1000px; 
        display: flex; 
        flex-direction: column;
        box-shadow: var(--shadow-lg); 
        border-radius: 16px;
        border: 1px solid var(--modal-border); 
        overflow: hidden;
        transform: scale(0.9) translateY(20px);
        transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1), background-color 0.3s;
    }
    
    .modal.active .modal__content { 
        transform: scale(1) translateY(0); 
    }
    
    .modal__close {
        position: absolute; 
        top: 15px; 
        right: 15px;
        background: rgba(0,0,0,0.3); 
        border: 1px solid var(--modal-border);
        border-radius: 50%; 
        width: 40px; 
        height: 40px;
        font-size: 24px; 
        color: #fff; 
        cursor: pointer; 
        z-index: 20;
        transition: all 0.3s ease; 
        display: flex; 
        align-items: center; 
        justify-content: center;
    }
    
    body.light-mode .modal__close { 
        color: var(--modal-text-primary); 
        background: rgba(255,255,255,0.4); 
    }
    
    .modal__close:hover { 
        background: var(--color-primary); 
        border-color: var(--color-primary); 
        color: #fff; 
        transform: rotate(90deg); 
    }

    /* Estilos do Scrollbar */
    .scrollbar-styled { 
        scrollbar-width: thin; 
        scrollbar-color: var(--color-primary) transparent; 
    }
    
    .scrollbar-styled::-webkit-scrollbar { 
        width: 8px; 
    }
    
    .scrollbar-styled::-webkit-scrollbar-track { 
        background: transparent; 
    }
    
    .scrollbar-styled::-webkit-scrollbar-thumb { 
        background-color: var(--color-primary); 
        border-radius: 4px; 
        border: 2px solid var(--modal-surface); 
    }

    /*
    ================================================================
    MODAL DE DETALHES (API) - REFINADO
    ================================================================
    */
    #api-modal .modal__content { 
        height: 90vh; 
        max-height: 850px; 
        background: transparent; 
    }
    
    body.light-mode #api-modal .modal__content { 
        background: var(--modal-surface); 
    }
    
    .modal-backdrop-image { 
        position: absolute; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        object-fit: cover; 
        z-index: 1; 
        transition: opacity 0.5s; 
    }
    
    body.light-mode .modal-backdrop-image { 
        opacity: 0.1; 
    }
    
    .modal-backdrop-overlay {
        position: absolute; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%;
        background: linear-gradient(to top, var(--modal-surface) 30%, rgba(12, 12, 16, 0.7) 60%, var(--modal-surface) 100%);
        z-index: 2; 
        transition: background 0.3s;
    }
    
    body.light-mode .modal-backdrop-overlay { 
        background: linear-gradient(to top, var(--modal-surface) 80%, transparent 100%); 
    }

    .modal-inner-content { 
        position: relative; 
        z-index: 3; 
        display: flex; 
        flex-direction: column; 
        height: 100%; 
        color: var(--modal-text-primary); 
    }
    
    .modal__header { 
        padding: 30px 40px; 
        padding-top: 70px; 
    }
    
    .modal__header h2 { 
        margin: 0; 
        font-family: var(--font-heading); 
        font-size: 3.5rem; 
        font-weight: 700;
        color: #fff; 
        line-height: 1.1; 
        text-shadow: 0 3px 8px #000;
    }
    
    body.light-mode .modal__header h2 { 
        color: var(--modal-text-primary); 
        text-shadow: none; 
    }
    
    .modal__tabs {
        display: flex; 
        padding: 0 40px; 
        position: relative;
        border-bottom: 1px solid var(--modal-border);
    }
    
    #modal-tab-indicator {
        position: absolute; 
        bottom: -1px; 
        height: 3px;
        background-color: var(--color-primary); 
        border-radius: 3px;
        transition: left 0.4s cubic-bezier(0.23, 1, 0.32, 1), width 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    }
    
    .modal__tab-btn {
        background: none; 
        border: none; 
        color: var(--modal-text-secondary);
        padding: 15px 25px; 
        font-size: 1rem; 
        font-weight: 700;
        cursor: pointer; 
        transition: color 0.3s;
        text-transform: uppercase;
    }
    
    .modal__tab-btn.active { 
        color: var(--modal-text-primary); 
    }

    .modal__body-wrapper { 
        overflow-y: auto; 
        flex-grow: 1; 
    }
    
    .modal-tab-panel { 
        display: none; 
        padding: 30px 40px; 
        animation: fadeIn 0.5s ease-in-out; 
    }
    
    .modal-tab-panel.active { 
        display: block; 
    }
    
    @keyframes fadeIn { 
        from { 
            opacity: 0; 
            transform: translateY(10px); 
        } 
        to { 
            opacity: 1; 
            transform: translateY(0); 
        } 
    }

    .modal__footer {
        padding: 20px 40px; 
        background-color: var(--color-surface-translucent);
        border-top: 1px solid var(--modal-border); 
        display: flex;
        justify-content: flex-end; 
        gap: 15px; 
        flex-shrink: 0;
    }
    
    .modal-section h4 {
        margin: 0 0 20px 0; 
        font-size: 1.5rem; 
        color: var(--modal-text-primary);
        font-family: var(--font-heading); 
        text-transform: uppercase;
        border-left: 4px solid var(--color-primary); 
        padding-left: 15px;
    }
    
    .meta-item { 
        background: rgba(0,0,0,0.2); 
        padding: 15px; 
        border-radius: 8px; 
    }
    
    body.light-mode .meta-item { 
        background: rgba(0,0,0,0.04); 
    }
    
    .modal-meta-grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); 
        gap: 20px; 
    }
    
    .meta-item__label { 
        display: block; 
        font-size: 0.8rem; 
        color: var(--modal-text-secondary); 
        margin-bottom: 6px; 
        text-transform: uppercase; 
        font-weight: 500;
    }
    
    .meta-item__value { 
        font-size: 1.1rem; 
        color: var(--modal-text-primary); 
        font-weight: 700;
    }
    
    .meta-item__value .certification-tag { 
        background: var(--modal-border); 
        padding: 4px 10px; 
        border-radius: 4px; 
        font-size: 0.9em; 
        display: inline-block; 
    }
    
    .modal-tags { 
        display: flex; 
        flex-wrap: wrap; 
        gap: 10px; 
    }
    
    .modal-tag {
        background-color: var(--modal-border); 
        color: var(--modal-text-primary);
        padding: 6px 15px; 
        border-radius: 20px; 
        font-size: 0.9em; 
        font-weight: 500;
        transition: all 0.2s;
    }
    
    .modal-tag:hover { 
        background-color: var(--color-primary); 
        color: #fff; 
    }
    
    .synopsis-content {
        max-height: 125px; 
        overflow: hidden; 
        position: relative;
        transition: max-height 0.5s ease-in-out;
        line-height: 1.7; 
        color: var(--modal-text-secondary);
    }
    
    .synopsis-content.is-expanded { 
        max-height: 1500px; 
    }
    
    .synopsis-content:not(.is-expanded)::after {
        content: ''; 
        position: absolute; 
        bottom: 0; 
        left: 0; 
        right: 0; 
        height: 60px;
        background: linear-gradient(to top, var(--modal-surface) 20%, transparent);
    }
    
    body.light-mode .synopsis-content:not(.is-expanded)::after {
        background: linear-gradient(to top, var(--modal-surface) 20%, transparent);
    }
    
    .btn-show-more {
        background: none; 
        border: none; 
        color: var(--color-primary);
        cursor: pointer; 
        font-weight: bold; 
        padding: 10px 0;
        display: block; 
        margin-top: 10px; 
        font-family: var(--font-body);
    }
    
    .trailer-container { 
        position: relative; 
        width: 100%; 
        padding-bottom: 56.25%; 
        height: 0; 
    }
    
    .trailer-container iframe { 
        position: absolute; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        border: none; 
        border-radius: 8px; 
    }
    
    .cast-grid { 
        display: grid; 
        gap: 20px; 
        grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); 
    }
    
    .cast-card { 
        text-align: center; 
    }
    
    .cast-card__img { 
        width: 100%; 
        border-radius: 8px; 
        margin-bottom: 12px; 
        background-color: var(--modal-border); 
        aspect-ratio: 2/3; 
        object-fit: cover; 
    }
    
    .cast-card__name { 
        font-weight: 700; 
        font-size: 0.95rem; 
        color: var(--modal-text-primary); 
        margin: 0 0 4px 0; 
    }
    
    .cast-card__role { 
        font-size: 0.8rem; 
        color: var(--modal-text-secondary); 
    }

    .reco-grid { 
        display: grid; 
        gap: 20px; 
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); 
    }
    
    .reco-card { 
        position: relative; 
        display: block; 
        text-decoration: none; 
        border-radius: 8px; 
        overflow: hidden; 
    }
    
    .reco-card__img { 
        width: 100%; 
        aspect-ratio: 2/3; 
        object-fit: cover; 
        background: var(--modal-border); 
        transition: transform 0.3s ease; 
    }
    
    .reco-card:hover .reco-card__img { 
        transform: scale(1.05); 
    }
    
    .reco-card__title {
        position: absolute; 
        bottom: 0; 
        left: 0; 
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.95) 20%, transparent);
        color: #fff; 
        font-size: 0.9rem; 
        padding: 25px 10px 10px 10px;
        margin: 0; 
        text-align: center; 
        font-weight: 700;
    }

    /*
    ================================================================
    MODAL DE VÍDEO - REFINADO
    ================================================================
    */
    #video-modal .modal__content {
        height: 95vh; 
        max-height: 850px; 
        padding: 0;
        display: grid; 
        grid-template-rows: auto 1fr;
    }
    
    #video-player-container { 
        position: relative; 
        padding-bottom: 56.25%; 
        height: 0; 
        background: #000; 
    }
    
    #video-player-container iframe { 
        position: absolute; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        border: none; 
        border-radius: 12px 12px 0 0; 
    }
    
    #video-comments-section { 
        display: flex; 
        flex-direction: column; 
        min-height: 0; 
        padding: 25px; 
    }
    
    #video-comments-section h3 {
        margin: 0 0 15px 0; 
        font-family: var(--font-heading);
        font-size: 1.8rem; 
        color: var(--color-text-primary);
        flex-shrink: 0; 
        text-transform: uppercase;
    }
    
    #video-comments-container { 
        overflow-y: auto; 
        padding-right: 15px; 
    }
    
    /* Estilos dos comentários... (mantidos do original, se adequados) */
    .comment-card { 
        display: flex; 
        gap: 15px; 
        margin-bottom: 20px; 
        padding-bottom: 20px; 
        border-bottom: 1px solid var(--color-border); 
    }
    
    .comment-card:last-child { 
        border-bottom: none; 
    }
    
    .comment-author-avatar img { 
        width: 40px; 
        height: 40px; 
        border-radius: 50%; 
    }
    
    .comment-body { 
        flex-grow: 1; 
    }
    
    .comment-author-name { 
        font-weight: 700; 
        color: var(--color-text-primary); 
        margin-right: 10px; 
    }
    
    .comment-date { 
        font-size: 0.8em; 
        color: var(--color-text-secondary); 
    }
    
    .comment-text { 
        color: var(--color-text-primary); 
        line-height: 1.6; 
        margin-top: 5px; 
        opacity: 0.9; 
    }

    /*
    ================================================================
    UI Geral e Animações
    ================================================================
    */
    .btn {
        font-family: var(--font-body); 
        padding: 12px 25px; 
        border-radius: 6px;
        border: 2px solid transparent; 
        cursor: pointer; 
        font-weight: 700;
        transition: all 0.3s ease; 
        display: inline-flex; 
        align-items: center;
        gap: 8px; 
        text-decoration: none; 
        font-size: 0.95rem; 
        text-transform: uppercase;
    }
    
    .btn--primary { 
        background-color: var(--color-primary); 
        color: var(--color-text-on-primary); 
        border-color: var(--color-primary); 
    }
    
    .btn--primary:hover { 
        background-color: transparent; 
        color: var(--color-primary); 
        transform: translateY(-2px); 
    }
    
    .btn--secondary { 
        background-color: var(--color-surface); 
        color: var(--color-text-primary); 
        border-color: var(--color-border); 
    }
    
    .btn--secondary:hover { 
        border-color: var(--color-text-secondary); 
    }
    
    .status-message { 
        padding: 40px 20px; 
        text-align: center; 
        color: var(--color-text-secondary); 
        font-size: 1.1rem; 
    }
    
    .status-message .fa-spinner { 
        color: var(--color-primary); 
        margin-right: 10px; 
    }
    
    .animated-section { 
        opacity: 0; 
        transform: translateY(30px); 
        transition: opacity 0.6s ease-out, transform 0.6s ease-out; 
    }
    
    .animated-section.is-visible { 
        opacity: 1; 
        transform: translateY(0); 
    }
    
    /*
    ================================================================
    ANIMAÇÕES E EFEITOS
    ================================================================
    */
    .fade-in {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease, transform 0.6s ease;
    }
    
    .fade-in.visible {
        opacity: 1;
        transform: translateY(0);
    }
    
    .pulse {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 rgba(229, 9, 20, 0.4);
        }
        70% {
            box-shadow: 0 0 0 10px rgba(229, 9, 20, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(229, 9, 20, 0);
        }
    }
    
    /*
    ================================================================
    RESPONSIVIDADE
    ================================================================
    */
    @media (max-width: 991px) {
        .section-header {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .news-filters {
            width: 100%;
            justify-content: center;
        }
        
        .main-nav {
            display: none;
        }
        
        .mobile-menu-btn {
            display: block;
        }
    }
    
    @media (max-width: 575px) {
        .news-card__meta {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .news-card__stats {
            width: 100%;
            justify-content: space-between;
        }
        
        .ranking-item a {
            grid-template-columns: 25px 50px 1fr;
            gap: 10px;
            padding: 10px;
        }
        
        .rank-number {
            font-size: 1.5rem;
        }
        
        .ranking-item img {
            width: 50px;
            height: 75px;
        }
        
        .header-logo {
            font-size: 2.2rem;
        }
        
        .header-logo .fa-cloud {
            font-size: 2rem;
        }
    }
</style>
</head>
<body>

<!-- NAVBAR UNIFICADA -->
<header class="main-header">
    <div class="container">
        <a href="#" class="header-logo">
            <i class="fas fa-cloud"></i>
            Akatsuki Hub
        </a>
        <nav class="main-nav">
            <a href="#" class="nav-link active">Notícias</a>
            <a href="#" class="nav-link">Animes</a>
            <a href="#" class="nav-link">Filmes</a>
            <a href="#" class="nav-link">Séries</a>
            <a href="#" class="nav-link">Comunidade</a>
        </nav>
        <button id="theme-toggle-btn" aria-label="Alternar tema">
            <i class="fas fa-moon theme-icon"></i>
            <i class="fas fa-sun theme-icon"></i>
        </button>
    </div>
</header>

<!-- LAYOUT PRINCIPAL DO CONTEÚDO -->
<div class="main-layout container" role="main">
    <main class="main-content-area">
        <section id="external-news" class="animated-section" aria-labelledby="section-title-web">
            <div class="section-header">
                <div>
                    <h2 id="section-title-web" class="section-title-main"><i class="fas fa-globe-americas"></i> Destaques</h2>
                    <p class="section-subtitle">Fique por dentro das últimas novidades do mundo do entretenimento, animes, filmes e muito mais.</p>
                </div>
                <div class="news-filters">
                    <button class="filter-btn active" data-filter="all">Todas</button>
                    <button class="filter-btn" data-filter="anime">Animes</button>
                    <button class="filter-btn" data-filter="filme">Filmes</button>
                    <button class="filter-btn" data-filter="trailer">Trailers</button>
                </div>
            </div>
            <div class="news-grid" id="external-news-container">
                <p class="status-message"><i class="fas fa-spinner fa-spin"></i> Carregando destaques...</p>
            </div>
            <div class="news-load-more">
                <button class="load-more-btn">
                    <i class="fas fa-redo"></i> Carregar Mais
                </button>
            </div>
        </section>
    </main>
    
    <aside class="sidebar" role="complementary">
        <div id="top-animes-widget" class="sidebar-widget animated-section" aria-labelledby="section-title-animes">
            <h3 id="section-title-animes"><i class="fas fa-fire-alt"></i> Top Animes</h3>
            <ol class="ranking-list" id="top-anime-list">
                <li class="status-message"><i class="fas fa-spinner fa-spin"></i> Carregando animes...</li>
            </ol>
        </div>
        <div id="top-movies-widget" class="sidebar-widget animated-section" aria-labelledby="section-title-movies">
            <h3 id="section-title-movies"><i class="fas fa-film"></i> Filmes Populares</h3>
            <ol class="ranking-list" id="top-movies-list">
                <li class="status-message"><i class="fas fa-spinner fa-spin"></i> Carregando filmes...</li>
            </ol>
        </div>
    </aside>
</div>

<!-- MODAL AVANÇADO PARA DETALHES DA API (JIKAN/TMDB) -->
<div id="api-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-api-title">
    <div class="modal__content">
        <img id="modal-backdrop" src="" alt="Backdrop" class="modal-backdrop-image" aria-hidden="true">
        <div class="modal-backdrop-overlay"></div>
        <div class="modal-inner-content">
            <header class="modal__header"><h2 id="modal-api-title">Carregando...</h2></header>
            <nav class="modal__tabs" id="modal-api-tabs" role="tablist">
                <!-- Abas geradas via JS -->
                 <div id="modal-tab-indicator"></div>
            </nav>
            <div class="modal__body-wrapper scrollbar-styled" id="modal-api-tab-panels">
                 <!-- Painéis gerados via JS -->
            </div>
            <footer class="modal__footer">
                <a href="#" id="modal-details-link" target="_blank" rel="noopener noreferrer" class="btn btn--primary" style="display: none;">
                    <i class="fas fa-info-circle"></i> Ver Original
                </a>
                <button class="btn btn--secondary modal__close">Fechar</button>
            </footer>
             <button class="modal__close" aria-label="Fechar modal">×</button>
        </div>
    </div>
</div>

<!-- MODAL PARA VÍDEO DO YOUTUBE E COMENTÁRIOS -->
<div id="video-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-video-title">
    <div class="modal__content">
        <button class="modal__close" aria-label="Fechar modal">×</button>
        <div id="video-player-container">
            <!-- Iframe do YouTube será injetado aqui -->
        </div>
        <section id="video-comments-section" aria-labelledby="video-comments-heading">
            <h3 id="video-comments-heading"><i class="fas fa-comments"></i> Comentários</h3>
            <div id="video-comments-container" class="scrollbar-styled">
                <!-- Comentários do YouTube serão injetados aqui -->
            </div>
        </section>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const JIKAN_API = 'https://api.jikan.moe/v4';
    const TMDB_API = 'https://api.themoviedb.org/3';
    const TMDB_KEY = 'ebc6c62b1d31f28ab2d155ad4c921657'; 
    const YOUTUBE_API_KEY = 'SUA_CHAVE_API_DO_YOUTUBE_AQUI'; 
    const YOUTUBE_API_URL = 'https://www.googleapis.com/youtube/v3';
    const IMG_PATH = 'https://image.tmdb.org/t/p/';
    const PLACEHOLDER_IMG = 'https://via.placeholder.com/300x450/101014/a1a1aa?text=Akatsuki';
    const PLACEHOLDER_BACKDROP = 'https://cutewallpaper.org/21/akatsuki-clouds-background/Akatsuki-Clouds-Wallpapers-Top-Free-Akatsuki-Clouds-.jpg';
    
    const body = document.body;

    // --- LÓGICA DO TEMA ---
    const themeToggleButton = document.getElementById('theme-toggle-btn');
    const currentTheme = localStorage.getItem('theme');
    if (currentTheme === 'light') body.classList.add('light-mode');
    themeToggleButton.addEventListener('click', () => {
        body.classList.toggle('light-mode');
        localStorage.setItem('theme', body.classList.contains('light-mode') ? 'light' : 'dark');
    });

    // --- SCROLL NAVBAR ---
    const header = document.querySelector('.main-header');
    window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
            header.classList.add('scrolled');
        } else {
            header.classList.remove('scrolled');
        }
    });

    // --- FUNÇÃO DE FETCH ---
    const fetchData = async (url) => {
        try {
            const res = await fetch(`${url}${url.includes('?') ? '&' : '?'}cache_bust=${new Date().getTime()}`);
            if (!res.ok) throw new Error(`API Error: ${res.status} em ${url}`);
            const data = await res.json();
            return data.data || data;
        } catch (error) {
            console.error(`Falha ao buscar dados:`, error);
            return null;
        }
    };

    // --- LÓGICA GENÉRICA DOS MODAIS ---
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        modal.querySelectorAll('.modal__close').forEach(button => button.addEventListener('click', () => closeModal(modal)));
        modal.addEventListener('click', e => (e.target === modal) && closeModal(modal));
    });
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
            const activeModal = document.querySelector('.modal.active');
            if (activeModal) closeModal(activeModal);
        }
    });
    
    const openModal = (modal) => {
        if (!modal) return;
        modal.classList.add('active');
        body.classList.add('modal-open');
    };
    
    const closeModal = (modal) => {
        if (!modal) return;
        modal.classList.remove('active');
        body.classList.remove('modal-open');
        if (modal.id === 'video-modal') {
            const iframeContainer = modal.querySelector('#video-player-container');
            if (iframeContainer) iframeContainer.innerHTML = '';
        }
    };

    // --- OBSERVER PARA ANIMAÇÕES ---
    const observer = new IntersectionObserver((entries, obs) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
                obs.unobserve(entry.target);
            }
        });
    }, { threshold: 0.1 });
    document.querySelectorAll('.animated-section').forEach(section => observer.observe(section));

    function extractYouTubeId(url) {
        if (!url) return null;
        const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
        const match = url.match(regExp);
        return (match && match[2].length === 11) ? match[2] : null;
    }

    // --- VARIÁVEIS GLOBAIS PARA PAGINAÇÃO ---
    let currentPage = 1;
    let currentFilter = 'all';
    let allNewsItems = [];

    // --- CARREGAMENTO DE CONTEÚDO DINÂMICO ---

    // Função para gerar diferentes tipos de cards de notícias
    function createNewsCard(item) {
        // Card de Lançamento de Anime (Texto)
        if (item.source === 'jikan_season') {
            const imageUrl = item.images?.jpg?.large_image_url || PLACEHOLDER_IMG;
            return `
                <a href="#" class="news-card btn-open-api-modal" data-type="jikan" data-id="${item.mal_id}" data-backdrop="${imageUrl}" data-category="anime">
                    <div class="news-card__image-container">
                        <img src="${imageUrl}" alt="Capa de ${item.title}" loading="lazy" onerror="this.src='${PLACEHOLDER_IMG}'"/>
                        <div class="news-card__category-badge">Anime</div>
                        <div class="news-card__overlay">
                            <span class="news-card__action-icon"><i class="fas fa-align-left"></i></span>
                        </div>
                    </div>
                    <div class="news-card__content">
                        <h4 class="news-card__title">${item.title_english || item.title}</h4>
                        <p class="news-card__excerpt">Novo lançamento da temporada que promete agradar os fãs.</p>
                        <div class="news-card__meta">
                            <div class="news-card__date">
                                <i class="far fa-calendar"></i>
                                <span>Em breve</span>
                            </div>
                            <div class="news-card__stats">
                                <div class="news-card__stat">
                                    <i class="fas fa-eye"></i>
                                    <span>${Math.floor(Math.random() * 1000) + 500}</span>
                                </div>
                                <div class="news-card__stat">
                                    <i class="far fa-comment"></i>
                                    <span>${Math.floor(Math.random() * 50) + 10}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </a>
            `;
        }
        
        // Card de Promo/Trailer (Vídeo)
        if (item.source === 'jikan_promo') {
            const promo = item.entry;
            const imageUrl = promo.images?.jpg?.large_image_url || PLACEHOLDER_IMG;
            const videoId = extractYouTubeId(item.trailer.url);
            if (!videoId) return '';

            return `
                <a href="#" class="news-card btn-open-video-modal" data-video-id="${videoId}" title="Assistir trailer de ${promo.title}" data-category="trailer">
                    <div class="news-card__image-container">
                        <img src="${imageUrl}" alt="Capa de ${promo.title}" loading="lazy" onerror="this.src='${PLACEHOLDER_IMG}'"/>
                        <div class="news-card__category-badge">Trailer</div>
                        <div class="news-card__overlay">
                            <span class="news-card__action-icon"><i class="fab fa-youtube"></i></span>
                        </div>
                    </div>
                    <div class="news-card__content">
                        <h4 class="news-card__title">${promo.title}</h4>
                        <p class="news-card__excerpt">Confira o trailer oficial deste anime que está dando o que falar.</p>
                        <div class="news-card__meta">
                            <div class="news-card__date">
                                <i class="far fa-calendar"></i>
                                <span>${new Date().toLocaleDateString('pt-BR')}</span>
                            </div>
                            <div class="news-card__stats">
                                <div class="news-card__stat">
                                    <i class="fas fa-eye"></i>
                                    <span>${Math.floor(Math.random() * 2000) + 1000}</span>
                                </div>
                                <div class="news-card__stat">
                                    <i class="far fa-comment"></i>
                                    <span>${Math.floor(Math.random() * 100) + 20}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </a>
            `;
        }
        
        // Card de Filme (TMDB)
        if (item.source === 'tmdb_movie') {
            const imageUrl = item.poster_path ? `${IMG_PATH}w500${item.poster_path}` : PLACEHOLDER_IMG;
            const backdropUrl = item.backdrop_path ? `${IMG_PATH}original${item.backdrop_path}` : PLACEHOLDER_BACKDROP;
            
            return `
                <a href="#" class="news-card btn-open-api-modal" data-type="tmdb" data-media-type="movie" data-id="${item.id}" data-backdrop="${backdropUrl}" data-category="filme">
                    <div class="news-card__image-container">
                        <img src="${imageUrl}" alt="Pôster de ${item.title}" loading="lazy" onerror="this.src='${PLACEHOLDER_IMG}'"/>
                        <div class="news-card__category-badge">Filme</div>
                        <div class="news-card__overlay">
                            <span class="news-card__action-icon"><i class="fas fa-film"></i></span>
                        </div>
                    </div>
                    <div class="news-card__content">
                        <h4 class="news-card__title">${item.title}</h4>
                        <p class="news-card__excerpt">${item.overview ? (item.overview.length > 120 ? item.overview.substring(0, 120) + '...' : item.overview) : 'Descrição não disponível.'}</p>
                        <div class="news-card__meta">
                            <div class="news-card__date">
                                <i class="far fa-calendar"></i>
                                <span>${item.release_date ? new Date(item.release_date).toLocaleDateString('pt-BR') : 'Em breve'}</span>
                            </div>
                            <div class="news-card__stats">
                                <div class="news-card__stat">
                                    <i class="fas fa-star"></i>
                                    <span>${item.vote_average ? item.vote_average.toFixed(1) : 'N/A'}</span>
                                </div>
                                <div class="news-card__stat">
                                    <i class="fas fa-eye"></i>
                                    <span>${Math.floor(Math.random() * 5000) + 1000}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </a>
            `;
        }
        
        // Card de Artigo/Post
        if (item.source === 'article') {
            return `
                <a href="#" class="news-card" data-category="${item.category}">
                    <div class="news-card__image-container">
                        <img src="${item.image || PLACEHOLDER_IMG}" alt="${item.title}" loading="lazy" onerror="this.src='${PLACEHOLDER_IMG}'"/>
                        <div class="news-card__category-badge">${item.category === 'anime' ? 'Anime' : 'Filme'}</div>
                        <div class="news-card__overlay">
                            <span class="news-card__action-icon"><i class="fas fa-newspaper"></i></span>
                        </div>
                    </div>
                    <div class="news-card__content">
                        <h4 class="news-card__title">${item.title}</h4>
                        <p class="news-card__excerpt">${item.excerpt}</p>
                        <div class="news-card__meta">
                            <div class="news-card__date">
                                <i class="far fa-calendar"></i>
                                <span>${item.date}</span>
                            </div>
                            <div class="news-card__stats">
                                <div class="news-card__stat">
                                    <i class="fas fa-eye"></i>
                                    <span>${item.views}</span>
                                </div>
                                <div class="news-card__stat">
                                    <i class="far fa-comment"></i>
                                    <span>${item.comments}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </a>
            `;
        }
        
        return '';
    }

    // Função para gerar artigos/posts fictícios
    function generateArticles() {
        const animeArticles = [
            {
                source: 'article',
                category: 'anime',
                title: 'Nova Temporada de One Piece Promete Revelar Segredos do Mundo',
                excerpt: 'A próxima temporada do anime mais longo da história promete revelar segredos sobre o mundo de One Piece que os fãs aguardam há anos.',
                image: 'https://via.placeholder.com/500x300/101014/a1a1aa?text=One+Piece',
                date: '15/05/2023',
                views: Math.floor(Math.random() * 5000) + 1000,
                comments: Math.floor(Math.random() * 200) + 50
            },
            {
                source: 'article',
                category: 'anime',
                title: 'Attack on Titan: Final Episódio Divide Opiniões dos Fãs',
                excerpt: 'O tão aguardado final de Attack on Titan foi ao ar e dividiu a comunidade de fãs entre aqueles que amaram e os que ficaram decepcionados.',
                image: 'https://via.placeholder.com/500x300/101014/a1a1aa?text=Attack+on+Titan',
                date: '10/05/2023',
                views: Math.floor(Math.random() * 8000) + 2000,
                comments: Math.floor(Math.random() * 500) + 100
            },
            {
                source: 'article',
                category: 'anime',
                title: 'Demon Slayer: Novo Arco do Anime Supera Expectativas',
                excerpt: 'O mais recente arco de Demon Slayer está sendo aclamado pela crítica e pelo público, com animação de qualidade excepcional.',
                image: 'https://via.placeholder.com/500x300/101014/a1a1aa?text=Demon+Slayer',
                date: '05/05/2023',
                views: Math.floor(Math.random() * 6000) + 1500,
                comments: Math.floor(Math.random() * 300) + 80
            }
        ];
        
        const movieArticles = [
            {
                source: 'article',
                category: 'filme',
                title: 'Super Mario Bros: O Filme Bate Recordes de Bilheteria',
                excerpt: 'A adaptação cinematográfica do famoso jogo da Nintendo superou todas as expectativas e se tornou um dos filmes de animação mais rentáveis do ano.',
                image: 'https://via.placeholder.com/500x300/101014/a1a1aa?text=Super+Mario',
                date: '20/05/2023',
                views: Math.floor(Math.random() * 7000) + 2000,
                comments: Math.floor(Math.random() * 400) + 100
            },
            {
                source: 'article',
                category: 'filme',
                title: 'John Wick 4: Ação Intensa e Coreografias Impressionantes',
                excerpt: 'O quarto filme da franquia John Wick eleva o nível das cenas de ação, com sequências memoráveis que deixaram os fãs maravilhados.',
                image: 'https://via.placeholder.com/500x300/101014/a1a1aa?text=John+Wick',
                date: '12/05/2023',
                views: Math.floor(Math.random() * 5500) + 1500,
                comments: Math.floor(Math.random() * 250) + 70
            },
            {
                source: 'article',
                category: 'filme',
                title: 'Guardiões da Galáxia Vol. 3: Emocionante Despedida da Equipe',
                excerpt: 'James Gunn entrega um final emocionante para os Guardiões da Galáxia, com momentos que tocaram o coração dos fãs da Marvel.',
                image: 'https://via.placeholder.com/500x300/101014/a1a1aa?text=Guardiões+da+Galáxia',
                date: '08/05/2023',
                views: Math.floor(Math.random() * 6500) + 1800,
                comments: Math.floor(Math.random() * 350) + 90
            }
        ];
        
        return [...animeArticles, ...movieArticles];
    }

    async function fetchAndDisplayExternalNews() {
        const container = document.getElementById('external-news-container');
        container.innerHTML = `<p class="status-message"><i class="fas fa-spinner fa-spin"></i> Carregando destaques...</p>`;

        // Buscar diferentes tipos de notícias
        const [promos, season, movies, articles] = await Promise.all([
            fetchData(`${JIKAN_API}/watch/promos`),
            fetchData(`${JIKAN_API}/seasons/upcoming?limit=6`),
            fetchData(`${TMDB_API}/movie/popular?api_key=${TMDB_KEY}&language=pt-BR&page=1`),
            Promise.resolve(generateArticles())
        ]);

        let combinedNews = [];
        
        // Adicionar promos de anime
        if (promos) {
            combinedNews.push(...promos.slice(0, 4).map(p => ({ ...p, source: 'jikan_promo' })));
        }
        
        // Adicionar temporada de anime
        if (season) {
            combinedNews.push(...season.slice(0, 4).map(s => ({ ...s, source: 'jikan_season' })));
        }
        
        // Adicionar filmes populares
        if (movies?.results) {
            combinedNews.push(...movies.results.slice(0, 4).map(m => ({ ...m, source: 'tmdb_movie' })));
        }
        
        // Adicionar artigos
        if (articles) {
            combinedNews.push(...articles);
        }

        // Embaralhar para misturar os tipos de notícias
        combinedNews.sort(() => Math.random() - 0.5);
        
        // Salvar para uso posterior na paginação
        allNewsItems = combinedNews;

        if (combinedNews.length === 0) {
            container.innerHTML = `<p class="status-message">Nenhum destaque encontrado.</p>`;
            return;
        }
        
        // Mostrar apenas os primeiros 9 itens inicialmente
        const initialItems = combinedNews.slice(0, 9);
        container.innerHTML = initialItems.map(createNewsCard).join('');
        
        // Ativar animações de entrada
        setTimeout(() => {
            document.querySelectorAll('.news-card').forEach(card => {
                card.classList.add('fade-in', 'visible');
            });
        }, 100);
        
        // Atualizar estado do botão "Carregar Mais"
        updateLoadMoreButton();
    }

    // Função para carregar mais notícias
    function loadMoreNews() {
        const container = document.getElementById('external-news-container');
        const loadMoreBtn = document.querySelector('.load-more-btn');
        
        loadMoreBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Carregando...';
        loadMoreBtn.disabled = true;
        
        // Simular carregamento
        setTimeout(() => {
            currentPage++;
            
            // Calcular quantos itens já foram mostrados
            const itemsPerPage = 9;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            
            // Filtrar itens se necessário
            let itemsToShow = allNewsItems;
            if (currentFilter !== 'all') {
                itemsToShow = allNewsItems.filter(item => {
                    if (currentFilter === 'anime') {
                        return item.source === 'jikan_season' || item.source === 'jikan_promo' || 
                               (item.source === 'article' && item.category === 'anime');
                    } else if (currentFilter === 'filme') {
                        return item.source === 'tmdb_movie' || 
                               (item.source === 'article' && item.category === 'filme');
                    } else if (currentFilter === 'trailer') {
                        return item.source === 'jikan_promo';
                    }
                    return true;
                });
            }
            
            // Verificar se há mais itens para mostrar
            if (startIndex >= itemsToShow.length) {
                loadMoreBtn.innerHTML = '<i class="fas fa-check"></i> Todos os itens carregados';
                loadMoreBtn.disabled = true;
                return;
            }
            
            // Adicionar novos itens
            const newItems = itemsToShow.slice(startIndex, endIndex);
            const newCardsHTML = newItems.map(createNewsCard).join('');
            container.innerHTML += newCardsHTML;
            
            // Ativar animações para os novos cards
            setTimeout(() => {
                document.querySelectorAll('.news-card').forEach(card => {
                    if (!card.classList.contains('fade-in')) {
                        card.classList.add('fade-in', 'visible');
                    }
                });
            }, 100);
            
            // Atualizar estado do botão
            updateLoadMoreButton();
            
            loadMoreBtn.innerHTML = '<i class="fas fa-redo"></i> Carregar Mais';
            loadMoreBtn.disabled = false;
        }, 800);
    }
    
    // Função para atualizar o estado do botão "Carregar Mais"
    function updateLoadMoreButton() {
        const loadMoreBtn = document.querySelector('.load-more-btn');
        const itemsPerPage = 9;
        const totalItems = currentFilter === 'all' ? allNewsItems.length : 
            allNewsItems.filter(item => {
                if (currentFilter === 'anime') {
                    return item.source === 'jikan_season' || item.source === 'jikan_promo' || 
                           (item.source === 'article' && item.category === 'anime');
                } else if (currentFilter === 'filme') {
                    return item.source === 'tmdb_movie' || 
                           (item.source === 'article' && item.category === 'filme');
                } else if (currentFilter === 'trailer') {
                    return item.source === 'jikan_promo';
                }
                return true;
            }).length;
        
        const itemsShown = currentPage * itemsPerPage;
        
        if (itemsShown >= totalItems) {
            loadMoreBtn.innerHTML = '<i class="fas fa-check"></i> Todos os itens carregados';
            loadMoreBtn.disabled = true;
        } else {
            loadMoreBtn.innerHTML = '<i class="fas fa-redo"></i> Carregar Mais';
            loadMoreBtn.disabled = false;
        }
    }

    async function populateTopAnimesSidebar() {
        const list = document.getElementById('top-anime-list');
        const animes = await fetchData(`${JIKAN_API}/top/anime?filter=airing&limit=5`);

        if (!animes?.length) {
            list.innerHTML = `<li class="status-message">Erro ao carregar.</li>`;
            return;
        }

        list.innerHTML = animes.map((anime, index) => `
            <li class="ranking-item">
                <a href="#" class="btn-open-api-modal" data-type="jikan" data-id="${anime.mal_id}" data-backdrop="${anime.images?.jpg?.large_image_url || PLACEHOLDER_BACKDROP}">
                    <div class="rank-number">${index + 1}</div>
                    <img src="${anime.images?.jpg?.image_url || PLACEHOLDER_IMG}" alt="Thumbnail ${anime.title}" onerror="this.src='${PLACEHOLDER_IMG}';">
                    <div class="rank-info">
                        <span class="title">${anime.title_english || anime.title}</span>
                        <span class="details">
                            <span><i class="fas fa-star"></i> ${anime.score || 'N/A'}</span>
                            <span><i class="fas fa-user-friends"></i> ${(anime.members || 0).toLocaleString('pt-BR')}</span>
                        </span>
                    </div>
                </a>
            </li>
        `).join('');
    }
    
    async function populateTopMoviesSidebar() {
        const list = document.getElementById('top-movies-list');
        const moviesData = await fetchData(`${TMDB_API}/movie/popular?api_key=${TMDB_KEY}&language=pt-BR&page=1`);
        
        if (!moviesData?.results?.length) {
            list.innerHTML = `<li class="status-message">Erro ao carregar.</li>`;
            return;
        }
        
        list.innerHTML = moviesData.results.slice(0, 5).map((filme, index) => `
            <li class="ranking-item">
                <a href="#" class="btn-open-api-modal" data-type="tmdb" data-media-type="movie" data-id="${filme.id}" data-backdrop="${filme.backdrop_path ? `${IMG_PATH}original${filme.backdrop_path}` : PLACEHOLDER_BACKDROP}">
                    <div class="rank-number">${index + 1}</div>
                    <img src="${filme.poster_path ? `${IMG_PATH}w185${filme.poster_path}` : PLACEHOLDER_IMG}" alt="Pôster ${filme.title}" onerror="this.src='${PLACEHOLDER_IMG}';">
                    <div class="rank-info">
                        <span class="title">${filme.title}</span>
                        <span class="details">
                            <span><i class="fas fa-star"></i> ${filme.vote_average.toFixed(1)}</span>
                            <span><i class="fas fa-calendar-alt"></i> ${filme.release_date ? filme.release_date.split('-')[0] : 'N/A'}</span>
                        </span>
                    </div>
                </a>
            </li>
        `).join('');
    }

    // --- LÓGICA DO MODAL DE VÍDEO E COMENTÁRIOS ---
    const videoModal = document.getElementById('video-modal');
    const playerContainer = document.getElementById('video-player-container');
    const commentsContainer = document.getElementById('video-comments-container');

    async function loadVideoAndComments(videoId) {
        playerContainer.innerHTML = '';
        commentsContainer.innerHTML = `<p class="status-message"><i class="fas fa-spinner fa-spin"></i> Carregando...</p>`;
        openModal(videoModal);
        playerContainer.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
        // Implementar fetch de comentários se a chave de API estiver disponível
    }
    
    // --- LÓGICA DO MODAL AVANÇADO (API) ---
    const apiModal = document.getElementById('api-modal');
    const modalTitleEl = document.getElementById('modal-api-title');
    const modalBackdropEl = document.getElementById('modal-backdrop');
    const modalTabsContainer = document.getElementById('modal-api-tabs');
    const modalPanelsContainer = document.getElementById('modal-api-tab-panels');
    const modalDetailsLinkEl = document.getElementById('modal-details-link');
    const modalTabIndicator = document.getElementById('modal-tab-indicator');

    function updateTabIndicator(activeTab) {
        if (!activeTab) {
            modalTabIndicator.style.width = '0px';
            return;
        }
        modalTabIndicator.style.left = `${activeTab.offsetLeft}px`;
        modalTabIndicator.style.width = `${activeTab.offsetWidth}px`;
    }

    apiModal.addEventListener('click', e => {
        const tabBtn = e.target.closest('.modal__tab-btn');
        if (tabBtn?.dataset.target) {
            apiModal.querySelectorAll('.modal__tab-btn, .modal-tab-panel').forEach(el => el.classList.remove('active'));
            tabBtn.classList.add('active');
            apiModal.querySelector(tabBtn.dataset.target)?.classList.add('active');
            updateTabIndicator(tabBtn);
        }
        const showMoreBtn = e.target.closest('.btn-show-more');
        if (showMoreBtn) {
            const content = showMoreBtn.previousElementSibling;
            if (content?.classList.toggle('is-expanded')) {
                showMoreBtn.textContent = 'Ler menos';
            } else {
                showMoreBtn.textContent = 'Ler mais';
            }
        }
    });

    // --- FILTRAGEM DE NOTÍCIAS ---
    function filterNews(category) {
        currentFilter = category;
        currentPage = 1;
        
        const container = document.getElementById('external-news-container');
        container.innerHTML = `<p class="status-message"><i class="fas fa-spinner fa-spin"></i> Filtrando...</p>`;
        
        setTimeout(() => {
            let filteredItems = allNewsItems;
            
            if (category !== 'all') {
                filteredItems = allNewsItems.filter(item => {
                    if (category === 'anime') {
                        return item.source === 'jikan_season' || item.source === 'jikan_promo' || 
                               (item.source === 'article' && item.category === 'anime');
                    } else if (category === 'filme') {
                        return item.source === 'tmdb_movie' || 
                               (item.source === 'article' && item.category === 'filme');
                    } else if (category === 'trailer') {
                        return item.source === 'jikan_promo';
                    }
                    return true;
                });
            }
            
            if (filteredItems.length === 0) {
                container.innerHTML = `<p class="news-empty-state">
                    <i class="fas fa-search"></i>
                    <h3>Nenhum resultado encontrado</h3>
                    <p>Tente alterar os filtros ou buscar por outros termos.</p>
                </p>`;
                document.querySelector('.news-load-more').style.display = 'none';
                return;
            }
            
            const itemsToShow = filteredItems.slice(0, 9);
            container.innerHTML = itemsToShow.map(createNewsCard).join('');
            
            // Ativar animações de entrada
            setTimeout(() => {
                document.querySelectorAll('.news-card').forEach(card => {
                    card.classList.add('fade-in', 'visible');
                });
            }, 100);
            
            // Atualizar estado do botão "Carregar Mais"
            updateLoadMoreButton();
            document.querySelector('.news-load-more').style.display = 'flex';
        }, 500);
    }

    // --- GATILHOS DE EVENTOS (DELEGAÇÃO) ---
    body.addEventListener('click', async e => {
        const openVideoBtn = e.target.closest('.btn-open-video-modal');
        if (openVideoBtn) {
            e.preventDefault();
            const videoId = openVideoBtn.dataset.videoId;
            if (videoId) await loadVideoAndComments(videoId);
            return;
        }

        const openApiBtn = e.target.closest('.btn-open-api-modal');
        if (openApiBtn) {
            e.preventDefault();
            modalTitleEl.textContent = 'Carregando...';
            modalTabsContainer.innerHTML = '<div id="modal-tab-indicator"></div>'; // Reset com indicador
            modalPanelsContainer.innerHTML = `<p class="status-message"><i class="fas fa-spinner fa-spin"></i> Buscando...</p>`;
            modalDetailsLinkEl.style.display = 'none';
            modalBackdropEl.src = openApiBtn.dataset.backdrop || PLACEHOLDER_BACKDROP;
            openModal(apiModal);
            
            const { type, id, mediaType } = openApiBtn.dataset;
            const renderer = type === 'jikan' ? renderJikanDetails : renderTmdbDetails;
            
            if (renderer) await renderer(id, mediaType);
        }
        
        // Filtros de notícias
        const filterBtn = e.target.closest('.filter-btn');
        if (filterBtn) {
            e.preventDefault();
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            filterBtn.classList.add('active');
            
            const filter = filterBtn.dataset.filter;
            filterNews(filter);
        }
        
        // Botão carregar mais
        const loadMoreBtn = e.target.closest('.load-more-btn');
        if (loadMoreBtn && !loadMoreBtn.disabled) {
            e.preventDefault();
            loadMoreNews();
        }
    });

    async function renderJikanDetails(id) {
        const details = await fetchData(`${JIKAN_API}/anime/${id}/full`);
        if (!details) {
            modalPanelsContainer.innerHTML = `<p class="status-message">Não foi possível carregar os detalhes.</p>`;
            return;
        }
        
        modalTitleEl.textContent = details.title_english || details.title;
        modalDetailsLinkEl.href = details.url;
        modalDetailsLinkEl.style.display = 'inline-flex';

        const tabs = [
            { id: 'overview', label: 'Visão Geral' },
            { id: 'chars', label: 'Personagens' },
            { id: 'recos', label: 'Recomendações' }
        ];

        modalTabsContainer.innerHTML = `
            ${tabs.map((tab, i) => `<button class="modal__tab-btn ${i === 0 ? 'active' : ''}" data-target="#panel-${tab.id}" role="tab">${tab.label}</button>`).join('')}
            <div id="modal-tab-indicator"></div>
        `;
        
        const genres = details.genres?.map(g => `<span class="modal-tag">${g.name}</span>`).join('') || 'N/A';
        const videoId = extractYouTubeId(details.trailer?.embed_url);
        const trailer = videoId ? `
            <div class="modal-section"><h4>Trailer</h4><div class="trailer-container"><iframe src="https://www.youtube.com/embed/${videoId}" allowfullscreen></iframe></div></div>
        ` : '';

        modalPanelsContainer.innerHTML = `
            <div id="panel-overview" class="modal-tab-panel active" role="tabpanel">
                <div class="modal-meta-grid">
                    <div class="meta-item"><span class="meta-item__label">Nota</span><span class="meta-item__value"><i class="fas fa-star" style="color:#f5c518;"></i> ${details.score || 'N/A'}</span></div>
                    <div class="meta-item"><span class="meta-item__label">Ano</span><span class="meta-item__value">${details.year || 'N/A'}</span></div>
                    <div class="meta-item"><span class="meta-item__label">Classificação</span><span class="meta-item__value"><span class="certification-tag">${details.rating?.split(' - ')[0] || 'N/A'}</span></span></div>
                    <div class="meta-item"><span class="meta-item__label">Status</span><span class="meta-item__value">${details.status || 'N/A'}</span></div>
                </div>
                <div class="modal-section"><h4>Gêneros</h4><div class="modal-tags">${genres}</div></div>
                <div class="modal-section"><h4>Sinopse</h4><div class="synopsis-content"><p>${details.synopsis?.replace(/\n/g, '<br>') || 'Não disponível.'}</p></div>${details.synopsis && details.synopsis.length > 300 ? '<button class="btn-show-more">Ler mais</button>' : ''}</div>
                ${trailer}
            </div>
            <div id="panel-chars" class="modal-tab-panel" role="tabpanel"><p class="status-message"><i class="fas fa-spinner fa-spin"></i> Carregando...</p></div>
            <div id="panel-recos" class="modal-tab-panel" role="tabpanel"><p class="status-message"><i class="fas fa-spinner fa-spin"></i> Carregando...</p></div>
        `;

        setTimeout(() => updateTabIndicator(apiModal.querySelector('.modal__tab-btn.active')), 50);
        loadJikanCharacters(id);
        loadJikanRecommendations(id);
    }

    async function renderTmdbDetails(id, mediaType) {
        const details = await fetchData(`${TMDB_API}/${mediaType}/${id}?api_key=${TMDB_KEY}&language=pt-BR&append_to_response=credits,videos,release_dates,recommendations`);
         if (!details) {
            modalPanelsContainer.innerHTML = `<p class="status-message">Não foi possível carregar os detalhes.</p>`;
            return;
        }
        
        modalTitleEl.textContent = details.title || details.name;
        modalDetailsLinkEl.href = `https://www.themoviedb.org/${mediaType}/${id}`;
        modalDetailsLinkEl.style.display = 'inline-flex';
        
        const tabs = [
            { id: 'overview', label: 'Visão Geral' },
            { id: 'cast', label: 'Elenco' },
            { id: 'recos', label: 'Similares' }
        ];

        modalTabsContainer.innerHTML = `
            ${tabs.map((tab, i) => `<button class="modal__tab-btn ${i === 0 ? 'active' : ''}" data-target="#panel-${tab.id}" role="tab">${tab.label}</button>`).join('')}
            <div id="modal-tab-indicator"></div>
        `;

        const releaseDate = details.release_date || details.first_air_date;
        const certObj = details.release_dates?.results?.find(r => r.iso_3166_1 === 'BR');
        const certification = certObj?.release_dates[0]?.certification || 'N/A';
        const genres = details.genres?.map(g => `<span class="modal-tag">${g.name}</span>`).join('') || 'N/A';
        const video = details.videos?.results?.find(v => v.site === 'YouTube' && v.type === 'Trailer');
        const trailer = video ? `<div class="modal-section"><h4>Trailer</h4><div class="trailer-container"><iframe src="https://www.youtube.com/embed/${video.key}" allowfullscreen></iframe></div></div>` : '';

        modalPanelsContainer.innerHTML = `
            <div id="panel-overview" class="modal-tab-panel active" role="tabpanel">
                <div class="modal-meta-grid">
                    <div class="meta-item"><span class="meta-item__label">Nota</span><span class="meta-item__value"><i class="fas fa-star" style="color:#f5c518;"></i> ${details.vote_average?.toFixed(1) || 'N/A'}</span></div>
                    <div class="meta-item"><span class="meta-item__label">Lançamento</span><span class="meta-item__value">${releaseDate ? new Date(releaseDate+'T00:00:00').toLocaleDateString('pt-BR') : 'N/A'}</span></div>
                    <div class="meta-item"><span class="meta-item__label">Classificação</span><span class="meta-item__value"><span class="certification-tag">${certification}</span></span></div>
                    <div class="meta-item"><span class="meta-item__label">Status</span><span class="meta-item__value">${details.status || 'N/A'}</span></div>
                </div>
                <div class="modal-section"><h4>Gêneros</h4><div class="modal-tags">${genres}</div></div>
                <div class="modal-section"><h4>Sinopse</h4><div class="synopsis-content"><p>${details.overview || 'Não disponível.'}</p></div>${details.overview ? '<button class="btn-show-more">Ler mais</button>' : ''}</div>
                ${trailer}
            </div>
            <div id="panel-cast" class="modal-tab-panel" role="tabpanel">${renderTmdbCredits(details.credits)}</div>
            <div id="panel-recos" class="modal-tab-panel" role="tabpanel">${renderTmdbRecommendations(details.recommendations?.results)}</div>
        `;
        setTimeout(() => updateTabIndicator(apiModal.querySelector('.modal__tab-btn.active')), 50);
    }
    
    async function loadJikanCharacters(id) {
        const data = await fetchData(`${JIKAN_API}/anime/${id}/characters`);
        const panel = document.getElementById('panel-chars');
        if (!panel || !data?.length) {
            if(panel) panel.innerHTML = `<p class="status-message">Nenhum personagem encontrado.</p>`;
            return;
        }
        const charactersHTML = data.slice(0, 18).map(item => `
            <div class="cast-card">
                <img class="cast-card__img" src="${item.character.images.jpg.image_url}" alt="${item.character.name}" loading="lazy" onerror="this.src='${PLACEHOLDER_IMG}'">
                <h5 class="cast-card__name">${item.character.name}</h5>
                <p class="cast-card__role">${item.role}</p>
            </div>
        `).join('');
        panel.innerHTML = `<div class="cast-grid">${charactersHTML}</div>`;
    }

    async function loadJikanRecommendations(id) {
        const data = await fetchData(`${JIKAN_API}/anime/${id}/recommendations`);
        const panel = document.getElementById('panel-recos');
        if (!panel || !data?.length) {
            if(panel) panel.innerHTML = `<p class="status-message">Nenhuma recomendação encontrada.</p>`;
            return;
        }
        const recosHTML = data.slice(0, 12).map(reco => `
            <a href="#" class="reco-card btn-open-api-modal" data-type="jikan" data-id="${reco.entry.mal_id}" data-backdrop="${reco.entry.images?.jpg?.large_image_url || PLACEHOLDER_BACKDROP}">
                <img class="reco-card__img" src="${reco.entry.images?.jpg?.image_url || PLACEHOLDER_IMG}" alt="${reco.entry.title}" loading="lazy" onerror="this.src='${PLACEHOLDER_IMG}'">
                <h5 class="reco-card__title">${reco.entry.title}</h5>
            </a>
        `).join('');
        panel.innerHTML = `<div class="reco-grid">${recosHTML}</div>`;
    }
    
    function renderTmdbCredits(credits) {
        if (!credits) return '<p class="status-message">Informações não disponíveis.</p>';
        const castHTML = credits.cast?.slice(0, 18).map(person => `
            <div class="cast-card">
                <img class="cast-card__img" src="${person.profile_path ? IMG_PATH + 'w185' + person.profile_path : PLACEHOLDER_IMG}" alt="${person.name}" loading="lazy">
                <h5 class="cast-card__name">${person.name}</h5>
                <p class="cast-card__role">${person.character}</p>
            </div>
        `).join('');
        return `<div class="cast-grid">${castHTML || '<p class="status-message">Elenco não encontrado.</p>'}</div>`;
    }

    function renderTmdbRecommendations(recos) {
        if (!recos?.length) return `<p class="status-message">Nenhum título similar encontrado.</p>`;
        const recosHTML = recos.slice(0, 12).map(reco => `
             <a href="#" class="reco-card btn-open-api-modal" data-type="tmdb" data-media-type="${reco.media_type}" data-id="${reco.id}" data-backdrop="${reco.backdrop_path ? IMG_PATH + 'original' + reco.backdrop_path : PLACEHOLDER_BACKDROP}">
                <img class="reco-card__img" src="${reco.poster_path ? IMG_PATH + 'w342' + reco.poster_path : PLACEHOLDER_IMG}" alt="${reco.title || reco.name}" loading="lazy">
                <h5 class="reco-card__title">${reco.title || reco.name}</h5>
            </a>
        `).join('');
        return `<div class="reco-grid">${recosHTML}</div>`;
    }
    
    // --- INICIALIZAÇÃO GERAL ---
    fetchAndDisplayExternalNews();
    populateTopAnimesSidebar();
    populateTopMoviesSidebar();
});
</script>
</body>
</html>